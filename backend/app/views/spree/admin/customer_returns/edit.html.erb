<%= render :partial => 'spree/admin/shared/order_tabs', :locals => { :current => Spree.t(:customer_returns) } %>

<% content_for :page_title do %>
  / <%= Spree.t(:customer_return) %>
<% end %>

<div class="panel panel-default">
  <table class="table">
    <tr>
      <th width="20%"><%= Spree.t(:number) %></th>
      <td><%= @customer_return.number %></td>
    </tr>
    <tr>
      <th><%= Spree.t(:created_at) %></th>
      <td><%= pretty_time(@customer_return.created_at) %></td>
    </tr>
    <tr>
      <th><%= Spree.t(:stock_location) %></th>
      <td><%= @customer_return.stock_location.try(:name) %></td>
    </tr>
    <tr>
      <th><%= Spree.t(:fully_reimbursed) %></th>
      <td>
        <span class="label <%= @customer_return.fully_reimbursed? ? "label-success" : "label-danger" %>">
          <%= @customer_return.fully_reimbursed? %>
        </span>
      </td>
    </tr>
    <tr>
      <th><%= Spree.t(:completely_decided) %></th>
      <td>
        <span class="label <%= @customer_return.completely_decided? ? "label-success" : "label-danger" %>">
          <%= @customer_return.completely_decided? %>
        </span>
      </td>
    </tr>
  </table>
</div>


<% if @manual_intervention_return_items.any? %>
  <div class="panel panel-default" data-hook="manual_intervention_return_items">
    <div class="panel-heading">
      <h3 class="panel-title">
        <%= Spree.t(:items_returned) %>: <%= Spree.t(:manual_intervention_required) %>
      </h3>
    </div>
    <%= render partial: 'return_item_decision', locals: {return_items: @manual_intervention_return_items, show_decision: true} %>
  </div>
<% end %>

<% if @pending_return_items.any? %>
  <div class="panel panel-default" data-hook="pending_return_items">
    <div class="panel-heading">
      <h3 class="panel-title">
        <%= Spree.t(:items_returned) %>: <%= Spree.t(:pending) %>
      </h3>
    </div>
    <%= render partial: 'return_item_decision', locals: {return_items: @pending_return_items, show_decision: true} %>
  </div>
<% end %>

<% if @accepted_return_items.any? %>
  <div class="panel panel-default" data-hook="accepted_return_items">
    <div class="panel-heading">
      <h3 class="panel-title"><%= Spree.t(:items_returned) %>: <%= Spree.t(:accepted) %></h3>
    </div>
    <%= render partial: 'return_item_decision', locals: {return_items: @accepted_return_items, show_decision: false} %>
  </div>
<% end %>

<% if @rejected_return_items.any? %>
  <div class="panel panel-default" data-hook="rejected_return_items">
    <div class="panel-heading">
      <h3 class="panel-title">
        <%= Spree.t(:items_returned) %>: <%= Spree.t(:rejected) %>
      </h3>
    </div>
    <%= render partial: 'return_item_decision', locals: {return_items: @rejected_return_items, show_decision: false} %>
  </div>
<% end %>

<% if @customer_return.reimbursements.any? %>
  <div class="panel panel-default" data-hook="reimbursements">
    <div class="panel-heading">
      <h3 class="panel-title"><%= Spree.t(:reimbursements) %></h3>
    </div>
    <%= render partial: 'reimbursements_table', locals: {reimbursements: @customer_return.reimbursements} %>
  </div>
<% else %>
  <div class="alert alert-info no-objects-found">
    <%= Spree.t(:no_resource_found, resource: plural_resource_name(Spree::Reimbursement)) %>
  </div>
<% end %>

<% if !@customer_return.fully_reimbursed? && @pending_reimbursements.empty? && can?(:create, Spree::Reimbursement) %>
  <fieldset data-hook="reimbursements" class="marginb">
    <% if @customer_return.completely_decided? %>
      <%= form_for [:admin, @order, Spree::Reimbursement.new] do |f| %>
        <%= hidden_field_tag :build_from_customer_return_id, @customer_return.id %>
        <%= f.button class: 'btn btn-primary' do %>
          <%= Spree.t(:create_reimbursement) %>
        <% end %>
      <% end %>
    <% else %>
      <div class="alert alert-info no-objects-found">
        <%= Spree.t(:unable_to_create_reimbursements) %>
      </div>
    <% end %>
  </fieldset>
<% end %>
